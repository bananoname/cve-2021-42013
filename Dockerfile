FROM ubuntu:20.04

# Set the environment variable to avoid interactive prompts
ENV DEBIAN_FRONTEND=noninteractive

# Cập nhật hệ thống và cài đặt các gói cần thiết
RUN apt-get update \
    && apt-get install -y wget curl make gcc perl \
    && apt-get install -y libapr1-dev libaprutil1-dev libpcre3-dev \
    && apt-get install -y libapache2-mod-php php

# Đặt múi giờ là Asia/Ho_Chi_Minh
RUN ln -fs /usr/share/zoneinfo/Asia/Ho_Chi_Minh /etc/localtime \
    && echo "Asia/Ho_Chi_Minh" > /etc/timezone \
    && apt-get update \
    && apt-get install -y tzdata \
    && dpkg-reconfigure --frontend noninteractive tzdata \
    && rm -rf /var/lib/apt/lists/*

# Tải và cài đặt Apache 2.4.50
RUN wget https://archive.apache.org/dist/httpd/httpd-2.4.50.tar.gz \
    && tar -xvf httpd-2.4.50.tar.gz \
    && cd httpd-2.4.50 \
    && ./configure --prefix=/ \
    && make \
    && make install

# Thêm file cấu hình Apache
ADD httpd.conf /conf/httpd.conf

# Tạo thư mục chứa mã nguồn trang web
RUN mkdir -p /apache2/htdocs

# Thêm mã HTML và PHP cho trang login
ADD index.php /apache2/htdocs/index.php
ADD login.php /apache2/htdocs/login.php

# Cấu hình Apache để chạy ở foreground
ENTRYPOINT ["httpd", "-D", "FOREGROUND"]

